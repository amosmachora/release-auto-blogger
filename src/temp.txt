name: "Publish Blog To Hashnode"

on:
  push:
    branches:
      - "testing-hashnode-blog"

# on:
#   workflow_run:
#     workflows: ["Publish"]
#     types:
#       - completed
#   push:
#     branches:
#       - "main"

jobs:
  publish:
    # if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
      - uses: actions/checkout@v3

      - name: Setup Node
      - uses: actions/setup-node@v3
        with:
          node-version: 16.x

      - name: Install dependencies
      - run: pnpm install --frozen-lockfile

      - name: Run tsup to Bundle TypeScript
      - run: pnpm run build

      - name: Run Hashnode Integration
      - run: node dist/hashnode/index.js

mutation {
  publishPost(input: {
    title: "Your Post Title"
    subtitle: "Optional subtitle for your post"
    publicationId: "PublicationIdIfApplicable"
    contentMarkdown: "Your post content in Markdown format."
    publishedAt: "2024-01-31T12:00:00Z"  # Replace with the actual publication date
    coverImageOptions: {
      coverImageURL: "URL",
      coverImageAttribution: "Attribution"
    }
    slug: "optional-slug-if-desired"
    originalArticleURL: "URLToOriginalArticleIfApplicable"
    tags: [
      { id: "TagId1", name: "Tag1" },
      { id: "TagId2", name: "Tag2" }
    ]
    disableComments: false
    metaTags: {
      title: "Meta Title"
      description: "Meta Description"
      image: "URLToMetaImage"
    }
    publishAs: "UserIdToPublishOnBehalfOf"
    seriesId: "SeriesIdIfApplicable"
    settings: {
      enableTableOfContent: true
    }
    coAuthors: ["CoAuthorUserId1", "CoAuthorUserId2"]
  }) {
    post {
      id
      title
      subtitle
      publishedAt
    }
  }
}
